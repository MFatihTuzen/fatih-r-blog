library(NHANES)
library(dplyr)
NHANES %>%
select(ID, Age, Gender, BMI, BPSysAve, Diabetes) %>% # filter variables
glimpse() # Take a quick look at the data
library(nhanesA)
# Already created 'nhanes_small' dataset in previous step
nhanes_sub |>
summarise(
bmi_missing = mean(is.na(BMXBMI)),
income_missing = mean(is.na(INDFMPIR)),
age_missing = mean(is.na(RIDAGEYR))
)
# Count missing values for each variable
nhanes_sub %>%
summarise(across(everything(), ~ sum(is.na(.))))
library(missForest)
set.seed(123)
nhanes_imputed <- missForest(nhanes_sub)
library(missForest)
nhanes_sub <- NHANES |>
select(ID, Age, Gender, BMI, BPSysAve, Diabetes)
set.seed(123)
nhanes_imputed <- missForest(nhanes_sub)
str(nhanes_sub)
mf_input <- nhanes_sub |>
select(Age, Gender, BMI, BPSysAve, Diabetes) |>
mutate(across(where(is.character), as.factor)) |>
as.data.frame()
set.seed(123)
mf_fit <- missForest(
mf_input,
ntree   = 200,    # more trees -> stabler imputations
maxiter = 5,      # outer iterations (default 10; 5 is fine for demo)
verbose = TRUE
)
# Completed data and OOB error
mf_imputed <- mf_fit$ximp
mf_oob     <- mf_fit$OOBerror
# Quick checks
sum(is.na(mf_input$BMI));  sum(is.na(mf_imputed$BMI))   # should go to 0
sum(is.na(mf_input$BMI))
sum(is.na(mf_imputed$BMI))
mf_oob
# View first rows of the imputed dataset
head(mf_imputed$ximp)
# Check imputation error
mf_imputed$OOBerror
# View first rows of the imputed dataset
head(mf_imputed)
# Complete-case analysis (ignores missing data)
lm_cc <- lm(BMI ~ Age + Gender + BPSysAve + Diabetes,
data = nhanes_sub, na.action = na.omit)
# Single imputation (mean imputation for BMI)
nhanes_single <- nhanes_sub |>
mutate(BMI = ifelse(is.na(BMI), mean(BMI, na.rm = TRUE), BMI))
lm_si <- lm(BMI ~ Age + Gender + BPSysAve + Diabetes,
data = nhanes_single)
# Multiple imputation with mice
imp <- mice(nhanes_sub, m = 5, method = "pmm", seed = 123)
library(mice)
# Complete-case analysis (ignores missing data)
lm_cc <- lm(BMI ~ Age + Gender + BPSysAve + Diabetes,
data = nhanes_sub, na.action = na.omit)
# Single imputation (mean imputation for BMI)
nhanes_single <- nhanes_sub |>
mutate(BMI = ifelse(is.na(BMI), mean(BMI, na.rm = TRUE), BMI))
lm_si <- lm(BMI ~ Age + Gender + BPSysAve + Diabetes,
data = nhanes_single)
# Multiple imputation with mice
imp <- mice(nhanes_sub, m = 5, method = "pmm", seed = 123)
lm_mi <- with(imp, lm(BMI ~ Age + Gender + BPSysAve + Diabetes))
pooled <- pool(lm_mi)
summary(lm_cc)
summary(lm_si)
summary(pooled)
